<div fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

    <mat-form-field fxFlex="48%">
      <mat-label><span [translate]="'modulo.loans.labels.charge'">Charge</span></mat-label>
      <mat-select #charge>
        <mat-option *ngFor="let charge of chargeData" [value]="charge">
          {{ charge.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  
    <div fxFlex="48%" fxFlexAlign="center">
      <button type="button" mat-raised-button color="primary" (click)="addCharge(charge)" [disabled]="!charge.value">
        <fa-icon icon="plus"></fa-icon>&nbsp;&nbsp;
       <span [translate]="'labels.buttons.Add'"> Add </span>
      </button>
    </div>
  
    <table fxFlex="98%" class="mat-elevation-z1" mat-table [dataSource]="chargesDataSource" [hidden]="chargesDataSource.length === 0">
  
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> <span [translate]="'modulo.loans.header.name'"> Name</span> </th>
        <td mat-cell *matCellDef="let charge">
          {{ charge.name + ', ' + charge.currency.displaySymbol }}
        </td>
      </ng-container>
  
      <ng-container matColumnDef="chargeCalculationType">
        <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.type'"> Type</span> </th>
        <td mat-cell *matCellDef="let charge">
          {{ charge.chargeCalculationType.value }}
        </td>
      </ng-container>
  
      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.amount'"> Amount </span></th>
        <td mat-cell *matCellDef="let charge">
          {{ charge.amount }} 
          <button mat-icon-button color="primary" (click)="editChargeAmount(charge)">
            <fa-icon icon="pen"></fa-icon>
          </button>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="chargeTimeType">
        <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.colleted'"> Collected On </span></th>
        <td mat-cell *matCellDef="let charge">
          {{ charge.chargeTimeType.value }}
        </td>
      </ng-container>
  
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.date'"> Date</span> </th>
        <td mat-cell *matCellDef="let charge">
          <span *ngIf="charge.chargeTimeType.value === 'Specified due date' || charge.chargeTimeType.value === 'Weekly Fee'">
            {{(charge.dueDate  | dateFormat) || ('modulo.labels.unassigned' | translate)}}
          </span>
          <span *ngIf="charge.chargeTimeType.value === 'Monthly Fee' || charge.chargeTimeType.value === 'Annual Fee'">
            {{(charge.feeOnMonthDay  | dateFormat) || ('modulo.labels.unassigned' | translate)}}
          </span>
          <span 
            *ngIf="!(charge.chargeTimeType.value === 'Monthly Fee' || charge.chargeTimeType.value === 'Annual Fee'
              || charge.chargeTimeType.value === 'Specified due date' || charge.chargeTimeType.value === 'Weekly Fee')">
            N/A
          </span>
          <button mat-icon-button color="primary"
            *ngIf="charge.chargeTimeType.value === 'Weekly Fee' || charge.chargeTimeType.value === 'Annual Fee'
                    || charge.chargeTimeType.value === 'Specified due date'" 
            (click)="editChargeDate(charge)">
            <fa-icon icon="pen"></fa-icon>
          </button>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="repaymentsEvery">
        <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.repayments'"> Repayments Every </span></th>
        <td mat-cell *matCellDef="let charge">
          {{ charge.feeInterval || ('modulo.labels.notprovided' | translate) }} 
          <button mat-icon-button color="primary" 
            *ngIf="charge.chargeTimeType.value === 'Weekly Fee' || charge.chargeTimeType.value === 'Monthly Fee'"
            (click)="editChargeFeeInterval(charge)">
            <fa-icon icon="pen"></fa-icon>
          </button>
        </td>
      </ng-container>
  
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef><span [translate]="'header.actions'"> Actions </span></th>
        <td mat-cell *matCellDef="let charge">
          <button mat-icon-button color="warn" (click)="deleteCharge(charge)">
            <fa-icon icon="trash"></fa-icon>
          </button>
        </td>
      </ng-container>
  
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  
    </table>
  
    <div fxFlex="98%" *ngIf="activeClientMembers">
      <table fxFlex="98%" mat-table [dataSource]="dataSource">
  
        <!-- Check Column -->
        <ng-container matColumnDef="check">
            <th mat-header-cell *matHeaderCellDef>
                <mat-checkbox (change)="toggleSelects()" [(ngModel)]="selectAllItems"></mat-checkbox>
            </th>
            <td mat-cell *matCellDef="let element">
                <mat-checkbox (change)="toggleSelect()" [(ngModel)]="element.selected"></mat-checkbox>
            </td>
        </ng-container>
    
        <!-- Position Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.clientid'"> Client ID </span></th>
          <td mat-cell *matCellDef="let element"> {{element.id}} </td>
        </ng-container>
    
        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.clientname'"> Client Name </span></th>
          <td mat-cell *matCellDef="let element"> {{element.displayName}} </td>
        </ng-container>

         <!-- Weight Column -->
         <ng-container matColumnDef="purpose">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.purpose'"> Loan Purpose </span></th>
          <td mat-cell *matCellDef="let element">
            <mat-form-field>
                <mat-label><span [translate]="'select.purpose'"> Select Purpose </span></mat-label>
                <mat-select [(ngModel)]="element.loanPurposeId">
                <mat-option *ngFor="let purpose of loanPurposeOptions" [value]="purpose.id">
                    {{ purpose.name }}
                </mat-option>
                </mat-select>
            </mat-form-field>
          </td>
        </ng-container>

        <!-- Symbol Column -->
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.original'"> Original Loan </span></th>
          <td mat-cell *matCellDef="let element">
            <mat-form-field>
                <input type="number" matInput [(ngModel)]="element.principal">
            </mat-form-field>
          </td>
        </ng-container>
    
    
        <tr mat-header-row *matHeaderRowDef="displayedColumn"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumn;"></tr>
      </table>
    </div>
    
  
  </div>
  
  <div fxLayout="row" class="margin-t" fxLayout.xs="column" fxLayoutAlign="center" fxLayoutGap="2%">
    <button mat-raised-button matStepperPrevious>
      <fa-icon icon="arrow-left"></fa-icon>&nbsp;&nbsp;
      <span [translate]="'labels.buttons.Previous'"> Previous</span>
    </button>
    <button mat-raised-button matStepperNext>
      <span [translate]="'labels.buttons.Next'">Next</span>&nbsp;&nbsp;
      <fa-icon icon="arrow-right"></fa-icon>
    </button>
  </div>
  