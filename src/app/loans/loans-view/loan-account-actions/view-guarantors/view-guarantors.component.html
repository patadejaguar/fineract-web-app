<div class="container mat-elevation-z8">

  <mat-card>

    <div class="view-guarantors-account-tables" fxLayout="row" fxLayoutGap="2%">

      <div fxFlex="49%">
        <table>
          <tbody>
            <tr>
              <td><span [translate]="'modulo.loans.labels.disbursementdate'">Disbursement Date</span></td>
              <td>{{dataObject.timeline.actualDisbursementDate}}<span
                  *ngIf="!dataObject.timeline.actualDisbursementDate">
                  <span [translate]="'modulo.validation.notavailable'">Not Available</span></span></td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.loans.labels.currency'">Currency</span></td>
              <td>{{dataObject.currency.name}}</td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.loans.labels.officer'">Loan Officer</span></td>
              <td>{{dataObject.loanOfficerName}} <span *ngIf="!dataObject.loanOfficerName">
                <span [translate]="'modulo.validation.unassigned'">Unassigned</span></span>
                <span *ngIf="dataObject.loanOfficerName">
                  <fa-icon icon="times"></fa-icon>
                </span></td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.loans.title.externalid'">External Id</span></td>
              <td>{{dataObject.externalId}}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div fxFlex="49%">
        <table>
          <tbody>
            <tr>
              <td><span [translate]="'modulo.loans.title.loanpurpose'">Loan Purpose</span></td>
              <td>
                {{dataObject.loanPurposeName}} <span *ngIf="!dataObject.loanPurposeName">
                  <span [translate]="'modulo.validation.noprovided'"> Not Provided</span> </span>
              </td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.loans.labels.approvedamount'">Approved Amount</span></td>
              <td>
                <span>{{dataObject.approvedPrincipal | number}}</span>
              </td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.loans.labels.disburseamount'">Disburse Amount</span></td>
              <td>
                <span>{{dataObject.principal | number}}</span>
              </td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.loans.labels.arrearby'">Arrears By</span></td>
              <td>{{dataObject.summary.totalOverdue | number}}
                <span *ngIf="dataObject.summary.totalOverdue < 0">
                  <span [translate]="'modulo.validation.noprovided'">Not Provided</span></span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div fxFlexFill *ngIf="guarantorDetails" fxLayout="row wrap" fxLayout.lt-md="column">

      <!-- guarantors details table -->
      <div class="heading-content">
        <div fxLayout="column" fxFlex="50%">
          <div class="heading-name">
            <h3><span [translate]="'modulo.loans.title.guarantor'">Guarantors Details</span></h3>
          </div>
        </div>
        <div fxLayout="column" fxFlex="50%">
          <div fxLayout="row" fxLayoutAlign="flex-end">
            <button mat-raised-button class="f-right" color="primary"
              (click)="toggleGuarantorsDetailsOverview()">
              {{(showDeletedGuarantorsAccounts?'modulo.labels.hidedeletedguarantors':'modulo.labels.showdeletedguarantors') | translate}}</button>
          </div>
        </div>
      </div>

      <table fxFlexFill mat-table
        [dataSource]="guarantorDetails|accountsFilter:'guarantor':showDeletedGuarantorsAccounts">
        <ng-container matColumnDef="fullname">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.name'"> Name</span> </th>
          <td mat-cell *matCellDef="let guarantor">
            <span *ngIf="!guarantor.guarantorFundingDetails">
              {{guarantor.firstname}} &nbsp; {{guarantor.lastname}}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="relationship">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.labels.relationship'"> Relationship</span> </th>
          <td mat-cell *matCellDef="let guarantor">
            <span *ngIf="!guarantor.guarantorFundingDetails">
              {{guarantor.clientRelationshipType.name}}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="guarantortype">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.labels.guarantortype'"> Guarantor Type </span></th>
          <td mat-cell *matCellDef="let guarantor">
            <span *ngIf="!guarantor.guarantorFundingDetails">
              {{guarantor.guarantorType.value}}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="depositAccount">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.labels.depositaccount'"> Deposit Account</span> </th>
          <td mat-cell *matCellDef="let guarantor">
            <span *ngIf="!guarantor.guarantorFundingDetails">

            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.amount'"> Amount</span></th>
          <td mat-cell *matCellDef="let guarantor">
            <span *ngIf="!guarantor.guarantorFundingDetails">

            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="remainingAmount">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.labels.remainingamount'"> Remaining Amount</span> </th>
          <td mat-cell *matCellDef="let guarantor">
            <span *ngIf="!guarantor.guarantorFundingDetails">

            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.labels.status'"> Status </span></th>
          <td mat-cell *matCellDef="let guarantor">
            <span *ngIf="!guarantor.guarantorFundingDetails">
              <span *ngIf="guarantor.status">
               <span [translate]="'status.active'"> Active</span>
              </span>
              <span *ngIf="!guarantor.status">
                <span [translate]="'status.deleted'">Deleted</span>
              </span>
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef><span [translate]="'modulo.loans.header.actions'"> Action</span> </th>
          <td mat-cell *matCellDef="let guarantor; let id = index">
            <span *ngIf="!guarantor.guarantorFundingDetails">
              <button mat-raised-button class="account-action-button" color="primary"
                *mifosxHasPermission="'READ_SAVINGSACCOUNT'" (click)="viewGuarantorDetails(guarantor)">
                <fa-icon icon="eye"></fa-icon>&nbsp;&nbsp;
              </button>
              <button mat-raised-button class="account-action-button" color="primary"
                *ngIf="guarantor.status && guarantor.guarantorType.id == 3 && guarantor.id">
                <fa-icon icon="edit"></fa-icon>&nbsp;&nbsp;
              </button>
              <span *ngIf="guarantor.status">
                <button mat-raised-button class="account-action-button" color="warn"
                  *mifosxHasPermission="'DELETE_GUARANTOR'" (click)="deleteGuarantor(guarantor.id)">
                  <fa-icon icon="trash"></fa-icon>&nbsp;&nbsp;
                </button>
              </span>
            </span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="guarantorsDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: guarantorsDisplayedColumns"></tr>

      </table>
    </div>

  </mat-card>

</div>
