<mat-card class="savings-account-card">

  <mat-card-header fxLayout="column" class="header">

    <mat-card-title-group class="header-title-group">

      <div class="profile-image-container">
        <div>
          <img mat-card-md-image class="profile-image"
            matTooltip="{{'modulo.labels.savingsaccount' | translate}}"
            [src]="'assets/images/savings_account_placeholder.png'">
        </div>
      </div>

      <div class="mat-typography account-card-title">
        <mat-card-title>
          <h3>
            <i class="fa fa-stop" [ngClass]="savingsAccountData.status.code | statusLookup" [matTooltip]="savingsAccountData.status.value"></i>
              <span [translate]="'modulo.labels.accountname'">Account Name </span>: {{savingsAccountData.savingsProductName}}
          </h3>
        </mat-card-title>
        <mat-card-subtitle>
          <p>
            <span [translate]="'modulo.labels.account'">Account</span> #: {{savingsAccountData.accountNo}} | {{entityType}}
            <span [translate]="'modulo.labels.name'"> Name</span>: {{savingsAccountData.clientName || savingsAccountData.groupName}}<br/>
            <span *ngIf="!savingsAccountData.status.rejected && !savingsAccountData.status.submittedAndPendingApproval">
              <span [translate]="'modulo.labels.currentbalance'">Current Balance</span>: {{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.accountBalance}}<br/>
              <span [translate]="'modulo.labels.availablebalance'">Available Balance</span>: {{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.availableBalance}}<br/>
            </span>
          </p>
        </mat-card-subtitle>
      </div>

    </mat-card-title-group>

    <mat-card-actions class="account-actions">

      <ng-container *ngFor="let button of buttonConfig.singleButtons">
        <button mat-raised-button *mifosxHasPermission="button.taskPermissionName" (click)="doAction(button.name)">
          <i class="{{button.icon}}"></i> {{button.name}}</button>
      </ng-container>
  
      <ng-container *ngIf="buttonConfig.options">
        <button mat-raised-button [matMenuTriggerFor]="More">
          <span [translate]="'modulo.labels.more'">More</span></button>
        <mat-menu #More="matMenu">
        <span *ngFor="let option of buttonConfig.options">
          <button mat-menu-item *mifosxHasPermission="option.taskPermissionName" (click)="doAction(option.name)">{{option.name}}</button>
        </span>
        </mat-menu>
      </ng-container>
  
    </mat-card-actions>

  </mat-card-header>

  <mat-card-content class="content">

    <div class="savings-account-tables" fxLayout="row" fxLayoutGap="2%">

      <div fxFlex="49%" *ngIf="!savingsAccountData.status.rejected && !savingsAccountData.status.submittedAndPendingApproval; else alternateSummary">
        <h4 class="table-headers"><span [translate]="'modulo.labels.accountsummary'">Account Summary</span></h4>
        <table>
          <tbody>
            <tr *ngIf="savingsAccountData.summary.totalWithdrawals">
              <td><span [translate]="'modulo.labels.totalwithdrawls'">Total Withdrawls</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.totalWithdrawals}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.summary.totalWithdrawalFees">
              <td><span [translate]="'modulo.labels.withdrawlsfees'">Withdrawals Fees</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.totalWithdrawalFees}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.summary.totalAnnualFees">
              <td><span [translate]="'modulo.labels.annualfees'">Annual Fees</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.totalAnnualFees}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.summary.totalInterestEarned >= 0">
              <td><span [translate]="'modulo.labels.interestearned'">Interest Earned</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.totalInterestEarned}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.summary.totalInterestPosted">
              <td><span [translate]="'modulo.labels.interestposted'">Interest Posted</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.totalInterestPosted}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.summary.interestNotPosted >= 0">
              <td><span [translate]="'modulo.labels.interestearnednotposted'">Interest Earned Not Posted</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.interestNotPosted}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.summary.totalOverdraftInterestDerived">
              <td><span [translate]="'modulo.labels.interestonoverdraft'">Interest On Overdraft</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.totalOverdraftInterestDerived}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.summary.interestNotPosted < 0">
              <td><span [translate]="'modulo.labels.overdraftinterestnotposted'">Overdraft Interest Not Posted</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.interestNotPosted}}</td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.labels.nominalinterestrate'">Nominal Interest Rate</span></td>
              <td>{{savingsAccountData.nominalAnnualInterestRate}}%</td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.labels.interestcompoundingperiod'">Interest Compounding Period</span></td>
              <td>{{savingsAccountData.interestCompoundingPeriodType.value}}</td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.labels.interestpostingperiod'">Interest Posting Period</span></td>
              <td>{{savingsAccountData.interestPostingPeriodType.value}}</td>
            </tr>
            <tr>
              <td><span [translate]="'modulo.labels.interestcalculatedusing'">Interest Calculated Using</span></td>
              <td>{{savingsAccountData.interestCalculationType.value}}</td>
            </tr>
            <tr>
              <td># <span [translate]="'modulo.labels.daysinyear'">Days in Year</span></td>
              <td>{{savingsAccountData.interestCalculationDaysInYearType.value}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.withdrawalFee">
              <td><span [translate]="'modulo.labels.withdrawalfee'">Withdrawal Fee</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.withdrawalFee.amount}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.lastActiveTransactionDate">
              <td><span [translate]="'modulo.labels.lastactivetransactiondate'">Last Active Transaction Date</span></td>
              <td>{{savingsAccountData.lastActiveTransactionDate  | dateFormat}}</td>
            </tr>
            <tr *ngIf="!(savingsAccountData.subStatus.id === 0)">
              <td><span [translate]="'modulo.labels.substatus'">Substatus</span></td>
              <td>{{savingsAccountData.subStatus.value}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.daysToInactive">
              <td><span [translate]="'modulo.labels.daystoinactive'">Days to Inactive</span></td>
              <td>{{savingsAccountData.daysToInactive}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.daysToDormancy">
              <td><span [translate]="'modulo.labels.daystodormancy'">Days to Dormancy</span></td>
              <td>{{savingsAccountData.daysToDormancy}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.daysToEscheat">
              <td><span [translate]="'modulo.labels.daystoescheat'">Days to Escheat</span></td>
              <td>{{savingsAccountData.daysToEscheat}}</td>
            </tr> 
            <tr *ngIf="savingsAccountData.annualFee">
              <td><span [translate]="'modulo.labels.annualfee'">Annual Fee</span></td>
              <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.annualFee.amount}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.allowOverdraft">
              <td><span [translate]="'modulo.labels.overdraftlimit'">Over Draft Limit</span></td>
              <td>{{savingsAccountData.overdraftLimit}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.allowOverdraft">
              <td><span [translate]="'modulo.labels.minoverdraftrequiredinterestcalculation'">
                Min Overdraft Required for Interest Calculation</span></td>
              <td>{{savingsAccountData.minOverdraftForInterestCalculation}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.minBalanceForInterestCalculation">
              <td><span [translate]="'modulo.labels.minbalancerequiredinterestcalculation'">
                Min Balance Required for Interest Calculation</span></td>
              <td>{{savingsAccountData.minBalanceForInterestCalculation}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.minRequiredBalance">
              <td><span [translate]="'modulo.labels.minrequiredbalance'">Minimum Required Balance</span></td>
              <td>{{savingsAccountData.minRequiredBalance}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.enforceMinRequiredBalance">
              <td><span [translate]="'modulo.labels.enforceminrequiredbalance'">Enforce Minimum Required Balance</span></td>
              <td>{{savingsAccountData.enforceMinRequiredBalance}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.summary.lastInterestCalculationDate">
              <td><span [translate]="'modulo.labels.interestrecalculationdate'">Interest Recalculation Date</span></td>
              <td>{{savingsAccountData.summary.lastInterestCalculationDate  | dateFormat}}</td>
            </tr>
            <tr *ngIf="savingsAccountData.onHoldFunds">
              <td><span [translate]="'modulo.labels.onholdfunds'">On Hold Funds</span></td>
              <td><a *mifosxHasPermission="'READ_SAVINGSACCOUNT'">{{savingsAccountData.onHoldFunds}}</a></td>
            </tr>
            <tr *ngIf="savingsAccountData.withHoldTax">
              <td><span [translate]="'modulo.labels.withholdtaxgroup'">Withhold Tax Group</span></td>
              <td>{{savingsAccountData.taxGroup.name}}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-template #alternateSummary>
        <div fxFlex="49%" >
          <h4 class="table-headers"><span [translate]="'modulo.labels.accountsummary'">Account Summary</span></h4>
          <table>
            <tbody>
              <tr>
                <td><span [translate]="'modulo.labels.activatedon'">Activated On</span></td>
                <td>{{savingsAccountData.timeline.activatedOnDate ? (savingsAccountData.timeline.activatedOnDate  | dateFormat) : 'Not Activated'}}</td>
              </tr>
              <tr>
                <td><span [translate]="'modulo.labels.currency'">Currency</span></td>
                <td>{{savingsAccountData.currency.name}} [{{savingsAccountData.currency.code}}]</td>
              </tr>
              <tr>
                <td><span [translate]="'modulo.labels.externalid'">External Id</span></td>
                <td>{{savingsAccountData.externalId ? savingsAccountData.externalId : 'Not Provided'}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </ng-template>

      <div fxFlex="49%" fxLayout="column" fxLayoutGap="4%">

        <div *ngIf="!savingsAccountData.status.rejected && !savingsAccountData.status.submittedAndPendingApproval; else alternateDetails">
          <h4 class="table-headers"><span [translate]="'modulo.labels.savingsdetails'">Savings Details</span></h4>
          <table>
            <tbody>
              <tr>
                <td><span [translate]="'modulo.labels.activatedon'">Activated On</span></td>
                <td>{{savingsAccountData.timeline.activatedOnDate ? (savingsAccountData.timeline.activatedOnDate  | dateFormat) : 'Not Activated'}}</td>
              </tr>
              <tr>
                <td><span [translate]="'modulo.labels.fieldofficer'">Field Officer</span></td>
                <td>{{savingsAccountData.fieldOfficerName ? savingsAccountData.fieldOfficerName : 'Unassigned'}}</td>
              </tr>
              <tr>
                <td><span [translate]="'modulo.labels.externalid'">External Id</span></td>
                <td>{{savingsAccountData.externalId ? savingsAccountData.externalId : 'Not Provided'}}</td>
              </tr>
              <tr>
                <td><span [translate]="'modulo.labels.currency'">Currency</span></td>
                <td>{{savingsAccountData.currency.name}} [{{savingsAccountData.currency.code}}]</td>
              </tr>
              <tr>
                <td><span [translate]="'modulo.labels.nominalinterestrate'">Nominal Interest Rate</span></td>
                <td>{{savingsAccountData.nominalAnnualInterestRate}}%</td>
              </tr>
            </tbody>
          </table>
        </div>

        <ng-template #alternateDetails>
          <div>
            <h4 class="table-headers"><span [translate]="'modulo.labels.savingsdetails'">Savings Details</span></h4>
            <table>
              <tbody>
                <tr>
                  <td><span [translate]="'modulo.labels.fieldofficer'">Field Officer</span></td>
                  <td>{{savingsAccountData.fieldOfficerName ? savingsAccountData.fieldOfficerName : 'Unassigned'}}</td>
                </tr>
                <tr>
                  <td><span [translate]="'modulo.labels.balance'">Balance</span></td>
                  <td>{{savingsAccountData.summary.accountBalance}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </ng-template>

        <div *ngIf="!savingsAccountData.status.rejected && !savingsAccountData.status.submittedAndPendingApproval">
          <h4 class="table-headers"><span [translate]="'modulo.labels.performancehistory'">Performance History</span></h4>
          <table>
            <tbody>
              <tr *ngIf="savingsAccountData.summary.totalDeposits">
                <td><span [translate]="'modulo.labels.totaldeposits'">Total Deposits</span></td>
                <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.totalDeposits}}</td>
              </tr>
              <tr *ngIf="savingsAccountData.summary.totalInterestEarned >= 0">
                <td><span [translate]="'modulo.labels.totalinterestearned'">Total Interest Earned</span></td>
                <td>{{savingsAccountData.currency.displaySymbol}}&nbsp;{{savingsAccountData.summary.totalInterestEarned}}</td>
              </tr>
          </table>
        </div>

      </div>

    </div>

    <nav mat-tab-nav-bar class="navigation-tabs">
      <a mat-tab-link [routerLink]="['./transactions']" routerLinkActive #transactions="routerLinkActive"
      [active]="transactions.isActive">
        <span [translate]="'modulo.labels.transactions'">Transactions</span>
      </a>
      <a mat-tab-link [routerLink]="['./charges']" routerLinkActive #charges="routerLinkActive"
      [active]="charges.isActive">
        <span [translate]="'modulo.labels.charges'">Charges</span>
      </a>
      <ng-container *mifosxHasPermission="'READ_SAVINGSACCOUNTCHARGE'">
        <a mat-tab-link [routerLink]="['./standing-instructions']" routerLinkActive #standingInstructions="routerLinkActive"
          [active]="standingInstructions.isActive" *ngIf="savingsAccountData.clientId">
          <span [translate]="'modulo.labels.standingintructions'">Standing Instructions</span>
        </a>
      </ng-container>
      <ng-container *ngFor="let savingsDatatable of savingsDatatables">
        <a mat-tab-link *mifosxHasPermission="'READ_' + savingsDatatable.registeredTableName"
          [routerLink]="['./datatables',savingsDatatable.registeredTableName]"
          routerLinkActive #datatable="routerLinkActive" [active]="datatable.isActive">
          {{savingsDatatable.registeredTableName}}
        </a>
      </ng-container>
    </nav>

    <router-outlet></router-outlet>

  </mat-card-content>

</mat-card>
